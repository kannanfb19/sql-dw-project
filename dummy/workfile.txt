INSERT INTO SILVER.crm_sales_details (

    SLS_ORD_NUM
    ,SLS_PRD_KEY
    ,SLS_CUST_ID
    ,SLS_ORDER_DT
    ,SLS_SHIP_DT
    ,SLS_DUE_DT
    ,SLS_SALES
    ,SLS_QUANTITY
    ,SLS_PRICE
    ,dwh_create_date)

SELECT 
     SLS_ORD_NUM
    ,SLS_PRD_KEY
    ,SLS_CUST_ID
    ,CASE WHEN SLS_ORDER_DT=0 OR LEN(SLS_ORDER_DT)!=8 THEN NULL
     ELSE TO_DATE(TO_VARCHAR(SLS_ORDER_DT),'YYYYMMDD') END AS SL_ORDER_DT
    ,CASE WHEN SLS_ORDER_DT=0 OR LEN(SLS_SHIP_DT)!=8 THEN NULL
     ELSE TO_DATE(TO_VARCHAR(SLS_SHIP_DT),'YYYYMMDD') END AS SLS_SHIP_DT
    ,CASE WHEN SLS_DUE_DT=0 OR LEN(SLS_DUE_DT)!=8 THEN NULL
     ELSE TO_DATE(TO_VARCHAR(SLS_DUE_DT),'YYYYMMDD') END AS SLS_DUE_DT
     ,CASE WHEN SLS_SALES IS NULL OR SLS_SALES<=0 OR SLS_SALES!=SLS_QUANTITY*ABS(SLS_PRICE)
          THEN SLS_QUANTITY * ABS(SLS_PRICE) ELSE SLS_SALES END AS SLS_SALES
    ,SLS_QUANTITY
    ,CASE WHEN SLS_PRICE IS NULL OR SLS_PRICE <=0
          THEN SLS_SALES / NULLIF(SLS_QUANTITY,0)  ELSE SLS_PRICE END AS SLS_PRICE
    ,CURRENT_DATE
FROM BRONZE.CRM_SALES_DETAILS;


----------------------------



  INSERT INTO SILVER.CRM_PROD_INFO(

    PRD_ID
   ,CAT_ID
   ,PRD_KEY
   ,PRD_NM
   ,PRD_COST
   ,PRD_LINE
   ,PRD_START_DT
   ,PRD_END_DT
   ,DWH_CREATE_DATE)

SELECT

    PRD_ID
   ,REPLACE(SUBSTR(PRD_KEY,1,5),'-','_') AS CAT_ID
   ,SUBSTR(PRD_KEY,7,LEN(PRD_KEY)) AS PRD_KEY
   ,PRD_NM
   ,PRD_COST
   --,PRD_LINE
   ,CASE UPPER(TRIM(prd_line))
        WHEN 'M' then 'MOUNTAIN'
        WHEN 'R' then 'ROAD'
        WHEN 'S' then 'Other Sales'
        WHEN 'R' then 'Touring'
        ELSE 'n/a' end as PRD_LINE
         
   ,PRD_START_DT :: DATE
   ,(LEAD(PRD_START_DT) OVER (PARTITION BY PRD_KEY ORDER BY PRD_START_DT) - INTERVAL '1 day') :: DATE AS PRD_END_DT
   ,CURRENT_DATE
FROM   BRONZE.CRM_PROD_INFO;


----------------------
INSERT INTO SILVER.ERP_LOC_AZ12(

        CID, BDATE,GEN
)

SELECT    
          REPLACE(CID,'NAS','') AS CID
         ,CASE WHEN BDATE>CURRENT_DATE THEN NULL  ELSE BDATE END AS BDATE
         ,CASE WHEN TRIM(GEN)='M' THEN 'Male'
               WHEN TRIM(GEN)='F' THEN 'Female'
               WHEN TRIM(GEN)='' THEN 'NA'
               ELSE GEN END AS GEN 
FROM DW.BRONZE.ERP_LOC_AZ12;


  
