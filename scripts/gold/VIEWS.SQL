

CREATE VIEW GOLD.DIM_CUSTOMER  AS
       SELECT 
        ROW_NUMBER() OVER (ORDER BY CUST_ID) AS CUSTOMER_KEY
        ,CI.CUST_ID AS CUSTOMER_ID
       ,CI.CST_KEY AS CUSTOMER_NUMBER
       ,CI.CST_FIRSTNAME AS FIRST_NAME
       ,CI.CST_LASTNAME AS LAST_NAME
       ,LA.CNTRY AS COUNTRY
       ,CI.CST_MATERIAL_STATUS AS MARTIAL_STATUS
       ,CASE WHEN CI.CST_GNDR!='n/a' THEN CI.CST_GNDR
                         ELSE COALESCE(CA.GEN,'n/a') END AS GENDER
       ,CI.CST_CREATE_DATE AS CREATE_DATE
       ,CA.BDATE AS BIRTH_DATE
       
       
    FROM SILVER.CRM_CUST_INFO CI
    LEFT JOIN SILVER.ERP_LOC_AZ12 CA
    ON CI.CST_KEY=CA.CID
    LEFT JOIN SILVER.ERP_LOC_A101 LA
    ON CI.CST_KEY=LA.CID;




CREATE VIEW GOLD.DIM_PRODUCT AS
SELECT 
        ROW_NUMBER () OVER(ORDER BY PN.PRD_START_DT,PN.PRD_KEY) AS PRODUCT_KEY
        ,PRD_ID AS PRODUCT_ID
        ,PRD_KEY AS PRODUCT_NUMBER
        ,PRD_NM AS PRODUCT_NAME
        ,CAT_ID AS CATEGORY_ID
        ,PC.CAT AS CATEGPRU
        ,PC.SUBCAT AS SUBCATEGORY
        ,PC.MAINTENANCE
        ,PRD_COST AS COST
        ,PRD_LINE  AS PRODUCT_LINE
        ,PRD_START_DT AS START_DATE

FROM SILVER.CRM_PROD_INFO PN
LEFT JOIN SILVER.ERP_PX_CAT_GLV2 PC
ON PN.CAT_ID=PC.ID
WHERE PRD_END_DT IS NULL;




CREATE VIEW GOLD.FACT_SALES AS
SELECT 

 SLS_ORD_NUM AS ORDER_NUMBER
,PR.PRODUCT_KEY 
,CU.CUSTOMER_KEY
,SLS_ORDER_DT AS ORDER_DATE
,SLS_SHIP_DT AS SHIPPING_DATE
,SLS_DUE_DT AS DUE_DATE
,SLS_SALES AS SALES_AMOUNT
,SLS_QUANTITY AS QUANTITY
,SLS_PRICE AS PRICE


FROM SILVER.CRM_SALES_DETAILS SD
LEFT JOIN GOLD.DIM_PRODUCT PR
ON SD.SLS_PRD_KEY=PR.PRODUCT_NUMBER
LEFT JOIN GOLD.DIM_CUSTOMER CU
ON SD.SLS_CUST_ID=CU.CUSTOMER_ID;
